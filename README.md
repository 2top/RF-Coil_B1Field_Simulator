# RF-Coil B1 Field Simulator

A comprehensive Python-based electromagnetic field simulation tool for RF coils. This application allows users to visualize and analyze magnetic (B) and electric (E) fields generated by RF coil geometries using the Biot-Savart law.

## Features

- **Multi-format Coil Import**: Support for STL, STEP (.stp/.step), and Gmsh (.msh) file formats
- **Automatic Mesh Generation**: Convert STEP CAD files to surface meshes with configurable parameters
- **Centerline & Surface Curve Extraction**: Automatically extract coil geometry features
- **Electromagnetic Field Computation**: Calculate B-field and E-field distributions using Biot-Savart law
- **3D Visualization**: Interactive PyVista-based visualization with multiple display modes
- **Coil Optimization**: Generate and evaluate populations of coil designs with parametric variations
- **Data Export**: Export field data and coil parameters to CSV files

## Installation

### Prerequisites

- Python 3.8 or higher
- A Python virtual environment (recommended)

### Required Dependencies

```bash
# Create and activate virtual environment
python3 -m venv venv
source venv/bin/activate  # On macOS/Linux
# OR
venv\Scripts\activate  # On Windows

# Install required packages
pip install numpy scipy pyvista PyQt5 vtk meshio gmsh scikit-learn matplotlib
```

### Key Dependencies:
- **PyQt5**: GUI framework
- **PyVista**: 3D visualization and mesh processing
- **Gmsh**: Mesh generation from CAD files
- **NumPy/SciPy**: Numerical computations
- **meshio**: Mesh file I/O

## Quick Start

### Running the Application

```bash
python3 rfcoil_field_visualizer.py
```

The main application window will open with three tabs:
1. **Mesh Processor**: Import and process coil geometry
2. **Field Visualization**: Compute and visualize electromagnetic fields
3. **Optimization**: Generate and optimize coil designs

## Usage Guide

### 1. Mesh Processor Tab

**Purpose**: Load and process coil geometry files

**Supported File Formats**:
- **STL** (.stl): Direct surface mesh import
- **STEP** (.stp, .step): CAD files (automatically meshed using Gmsh)
- **MSH** (.msh): Gmsh mesh files (for reusing previously generated meshes)

**Workflow**:
1. Select file type (STL, STEP, or MSH) using radio buttons
2. Click "Load File" and select your coil geometry file
3. **For STEP files only**: Configure meshing parameters:
   - **Element Size**: Base mesh element size (smaller = finer mesh)
   - **Size Factor**: Multiplier for element size (adjust mesh density)
   - **Sizing Mode**: Uniform or adaptive mesh sizing
   - **Feature Angle**: Angle threshold for edge detection (30-90°, default 75°)
4. Click "Generate Surface Curves" to extract current paths on the coil surface
5. Click "Export to Visualizer" to send the processed coil to the Field Visualization tab

**Notes**:
- The geometry will be plotted in the visualization window after loading
- For STEP files, a .msh file is generated and can be reloaded later to skip meshing
- Surface curves represent approximations of current distribution on the coil


### 2. Optimization Tab

**Purpose**: Generate and evaluate populations of parametric coil designs

**Coil Parameters**:

Adjustable parameters with min/max bounds for optimization:
- **radius_y**: Coil radius in Y-Z plane
- **turns**: Number of coil turns
- **length**: Coil length along X-axis
- **alpha**: Sigmoid sharpness parameter (controls turn spacing)
- **r0**: Wire radius (cross-section)
- **Min Spacing**: Minimum spacing between adjacent turns

**Volume Definition**:

Define cylindrical volume for field evaluation:
- Cylinder radius and length
- Axis direction (x, y, z components)
- Point spacing for field sampling

**Population Generation**:

1. Set "Number of Coils" for population size
2. Click "Generate Population" to create randomized coil variations
3. Each coil is evaluated for field uniformity in the defined volume

**Visualization**:

- Click "Visualize Base Coil" to preview the base coil design
- Enter a Coil ID and click "View Selected Coil" to visualize specific designs
- Use "Show Performance Plot" to analyze parameter vs. performance correlations

**Export to Field Visualization**:

Click "Export to Visualizer" to send the current coil to the Field Visualization tab for detailed analysis.


### 3. Field Visualization Tab

**Purpose**: Calculate and visualize electromagnetic fields around the coil

**Region Definition**:

Choose one of three region types for field computation:

- **Volume**: Rectangular 3D region
  - Set X, Y, Z min/max bounds
  - Specify spacing between computation points
  - Optional: Exclude points inside mesh with exclusion distance

- **Plane**: 2D planar region
  - Define plane origin (x, y, z)
  - Specify plane normal vector
  - Set plane dimensions (length × width)
  - Specify point spacing

- **Line**: 1D linear region
  - Define start and end points
  - Set number of points along the line

**Field Computation**:

1. Select field type: **B-field (magnetic)** or **E-field (electric)**
   - E-field computation requires frequency (currently greyed out)
2. Set current value (Amperes)
3. Choose whether to use surface curves or centerline
4. Click "Compute Field" to calculate field values

**Visualization Modes**:

After computation, select from various display modes:
- **Vector- Magnitude (Color), Direction (Arrow)**: Color-coded magnitude with direction arrows
- **Vector, Magnitude & Direction**: Combined vector and magnitude display
- **Magnitude**: Scalar field magnitude only
- **Bx, By, Bz (Color Only)**: Individual field components as color maps
- **Bx, By, Bz (Arrow)**: Individual components as vector arrows

**Display Options** (checkboxes):
- Hide/show coil geometry (surface mesh)
- Hide/show centerline
- Hide/show coordinate axes
- Hide/show computation region points
- Hide/show reference grid

**Additional Features**:
- **Compute Inductance**: Calculate static inductance from B-field (volume must enclose coil)
- **Export Data**: Save field values and metadata to CSV files


## File Structure

```
RF-Coil_B1Field_Simulator/
├── rfcoil_field_visualizer.py  # Main application (run this file)
├── helpers.py                   # Geometry processing utilities
├── README.md                    # This file
├── LICENSE                      # License information
└── venv/                        # Python virtual environment (created by user)
```